<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Operario ‚Äì Workshop App</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #1a1a2e;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .card {
      background: white;
      border-radius: 16px;
      padding: 32px 24px;
      width: 100%;
      max-width: 420px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.4);
    }
    h2 { font-size: 22px; color: #1a1a2e; margin-bottom: 6px; }
    .sub { color: #6b7280; font-size: 14px; margin-bottom: 24px; }

    .info-box {
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      border-radius: 10px;
      padding: 14px 16px;
      margin-bottom: 12px;
    }
    .info-box .lbl { font-size: 11px; color: #6b7280; font-weight: 700; text-transform: uppercase; }
    .info-box .val { font-size: 16px; font-weight: 700; color: #1e40af; margin-top: 3px; }

    label { display: block; font-size: 13px; font-weight: 600; color: #444; margin-bottom: 6px; margin-top: 20px; }
    input, textarea {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
      outline: none;
      font-family: inherit;
    }
    input:focus, textarea:focus { border-color: #25D366; }
    textarea { resize: vertical; min-height: 100px; }

    .preview {
      background: #f9fafb;
      border: 2px dashed #d1d5db;
      border-radius: 10px;
      padding: 16px;
      margin-top: 20px;
      font-size: 14px;
      color: #374151;
      line-height: 1.7;
      white-space: pre-wrap;
    }
    .preview-title { font-size: 12px; font-weight: 700; color: #9ca3af; text-transform: uppercase; margin-bottom: 8px; }

    .btn {
      width: 100%;
      padding: 16px;
      background: #25D366;
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      margin-top: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    .btn:active { opacity: 0.85; }
  </style>
</head>
<body>
<div class="card">
  <h2>üìã Aviso de trabajo</h2>
  <p class="sub">Rellena los datos y env√≠a el mensaje</p>

  <div class="info-box">
    <div class="lbl">Proyecto</div>
    <div class="val" id="info-proyecto">‚Äî</div>
  </div>
  <div class="info-box">
    <div class="lbl">Formato</div>
    <div class="val" id="info-formato">‚Äî</div>
  </div>

  <label>Tu nombre</label>
  <input type="text" id="nombre" placeholder="Ej: Juan Garc√≠a" oninput="actualizarPreview()" />

  <label>Mensaje adicional (opcional)</label>
  <textarea id="mensaje-extra" placeholder="Ej: Todo correcto, sin incidencias..." oninput="actualizarPreview()"></textarea>

  <div class="preview">
    <div class="preview-title">Vista previa del mensaje</div>
    <span id="preview-texto">Rellena tu nombre para ver el mensaje...</span>
  </div>

  <button class="btn" onclick="enviarWhatsApp()">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347z"/><path d="M12 0C5.373 0 0 5.373 0 12c0 2.124.558 4.118 1.532 5.845L.057 23.484a.5.5 0 00.603.634l5.798-1.521A11.95 11.95 0 0012 24c6.627 0 12-5.373 12-12S18.627 0 12 0zm0 21.9a9.9 9.9 0 01-5.031-1.37l-.361-.214-3.741.981.999-3.648-.235-.374A9.86 9.86 0 012.1 12c0-5.463 4.437-9.9 9.9-9.9 5.463 0 9.9 4.437 9.9 9.9 0 5.463-4.437 9.9-9.9 9.9z"/></svg>
    Enviar por WhatsApp
  </button>
</div>

<script>
  const WHATSAPP_NUMERO = "34606664908";
  let formatoData = { proyecto: "", formato: "", ot: "" };

  window.onload = () => {
    const p = new URLSearchParams(window.location.search);
    formatoData.proyecto = p.get("proyecto") || "";
    formatoData.formato  = p.get("formato")  || "";
    formatoData.ot       = p.get("ot")       || "";

    document.getElementById("info-proyecto").textContent =
      formatoData.ot ? formatoData.ot + " ‚Äì " + formatoData.proyecto : formatoData.proyecto || "Sin proyecto";
    document.getElementById("info-formato").textContent =
      formatoData.formato || "Sin formato";

    actualizarPreview();
  };

  function generarMensaje() {
    const nombre = document.getElementById("nombre").value.trim();
    const extra  = document.getElementById("mensaje-extra").value.trim();
    const fecha  = new Date().toLocaleDateString("es-ES", { day:"2-digit", month:"2-digit", year:"numeric", hour:"2-digit", minute:"2-digit" });
    const proyecto = formatoData.ot ? formatoData.ot + " ‚Äì " + formatoData.proyecto : formatoData.proyecto || "Sin proyecto";

    let msg = "üé¨ *Aviso de grabaci√≥n*\n\n";
    msg += "üìÅ *Proyecto:* " + proyecto + "\n";
    msg += "üìã *Formato:* " + (formatoData.formato || "Sin formato") + "\n";
    msg += "üë∑ *Operario:* " + (nombre || "Sin nombre") + "\n";
    msg += "üìÖ *Fecha:* " + fecha + "\n";
    if (extra) msg += "\nüí¨ *Notas:* " + extra;
    return msg;
  }

  function actualizarPreview() {
    document.getElementById("preview-texto").textContent = generarMensaje();
  }

  function enviarWhatsApp() {
    const nombre = document.getElementById("nombre").value.trim();
    if (!nombre) {
      alert("Por favor escribe tu nombre antes de enviar.");
      document.getElementById("nombre").focus();
      return;
    }
    const msg = generarMensaje();
    window.open("https://wa.me/" + WHATSAPP_NUMERO + "?text=" + encodeURIComponent(msg), "_blank");
  }
</script>
</body>
</html>
